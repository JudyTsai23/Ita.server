<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.web.server.dao.IMenuDao">

	<!-- 查詢所有餐點 -->
	<select id="queryMenu" resultMap="mybatis.mapper.entity.menuEntity">
		SELECT * FROM MEALS
		WHERE IS_PUBLIC = 1 AND (LIMIT_DATE >= #{today} OR LIMIT_DATE IS NULL)
		ORDER BY CATEGORY ASC, SUB_CATEGORY ASC, -SORT DESC
		<!-- 說明：因為 ORDER BY 會是 NULL < 1 < 2 <...，所以需要加上負號並遞減排序 -->
	</select>
	
	<!-- 查詢特定種類的餐點 -->
	<select id="queryCategoryMenu" resultMap="mybatis.mapper.entity.menuEntity">
		SELECT * FROM MEALS
		WHERE CATEGORY = #{category} AND IS_PUBLIC = 1 AND (LIMIT_DATE >= #{today} OR LIMIT_DATE IS NULL)
		ORDER BY SUB_CATEGORY ASC, -SORT DESC
		<!-- 說明：因為 ORDER BY 會是 NULL < 1 < 2 <...，所以需要加上負號並遞減排序 -->
	</select>

	<!-- 新增餐點 -->
	<insert id="insertMenu">
		INSERT INTO MEALS (
			ID,
			CATEGORY,
			SUB_CATEGORY,
			NAME,
			DESCRIPTION,
			INGREDIENT,
			NOTE,
			PRICE,
			IMAGE,
			ADDED_TIME,
			LIMIT_DATE,
			SORT,
			IS_PUBLIC,
			UPD_TIME
		)
		VALUES (
			#{menuEntity.id},
			#{menuEntity.category},
			#{menuEntity.subCategory},
			#{menuEntity.name},
			#{menuEntity.description},
			#{menuEntity.ingredient},
			#{menuEntity.note},
			#{menuEntity.price},
			#{menuEntity.image},
			#{menuEntity.addedTime},
			#{menuEntity.limitDate},
			#{menuEntity.sort},
			#{menuEntity.isPublic},
			#{menuEntity.updTime}
		)
	</insert>

	<!-- 查詢特定餐點 -->
	<select id="querySpecMenu" resultMap="mybatis.mapper.entity.menuEntity">
		SELECT * FROM MEALS
		WHERE ID = #{menuId}
	</select>
	
	<!-- 刪除特定餐點 -->
	<delete id="deleteSpecMenu">
		DELETE FROM MEALS WHERE ID = #{menuId}
	</delete>
	
</mapper>